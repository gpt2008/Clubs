{"ast":null,"code":"import dayjs from\"dayjs\";import React from\"react\";import{withTranslation}from\"react-i18next\";import enumAppointmentStatusNew from\"types/enums/EnumAppointmentStatusNew\";import{Rest}from\"../../utils/utils\";import View from\"./DoctorsCalendar\";import{jsx as _jsx,Fragment as _Fragment}from\"react/jsx-runtime\";class DoctorsCalendarContainer extends React.Component{constructor(){super(...arguments);this.state={};this.calendarComponentRef=/*#__PURE__*/React.createRef();this.loadData=()=>{this.setState({loaded:true});};this.events=(info,successCallback)=>{Rest().operation({type:\"GetProviderSchedulesSlots\",idProvider:this.props.prestadorSelected,dateStart:info.start,dateEnd:info.end}).then(response=>{successCallback(this.setEventStruct(response));});};this.setEventStruct=allEvents=>{var _allEvents$slots,_allEvents$appointmen;const events=[];(_allEvents$slots=allEvents.slots)===null||_allEvents$slots===void 0?void 0:_allEvents$slots.forEach(slot=>{let i=slot.valueStart;while(i<slot.valueEnd){const dateStart=dayjs(dayjs(slot.date).format(\"DD/MM/YYYY\"),\"DD/MM/YYYY\").toDate();dateStart.setMinutes(i);const dateEnd=dayjs(dayjs(slot.date).format(\"DD/MM/YYYY\"),\"DD/MM/YYYY\").toDate();dateEnd.setMinutes(i+slot.valueInterval);events.push({start:dateStart,end:dateEnd,extendedProps:{idScheduleSlot:slot.idScheduleSlot},display:\"background\"});i+=slot.valueInterval;}});(_allEvents$appointmen=allEvents.appointments)===null||_allEvents$appointmen===void 0?void 0:_allEvents$appointmen.forEach(appointment=>{const dateStart=dayjs(dayjs(appointment.dateAppointment).format(\"DD/MM/YYYY\"),\"DD/MM/YYYY\").toDate();dateStart.setMinutes(appointment.valueTime);const dateEnd=dayjs(dayjs(appointment.dateAppointment).format(\"DD/MM/YYYY\"),\"DD/MM/YYYY\").toDate();dateEnd.setMinutes(appointment.valueTime+appointment.valueDuration);let appointmentStatus=\"confirmed\";switch(appointment.typeStatus){case enumAppointmentStatusNew.PROPOSED:appointmentStatus=\"proposed\";break;case enumAppointmentStatusNew.CANCELLED:appointmentStatus=\"cancelled\";break;case 5:appointmentStatus=\"payment\";break;default:break;}events.push({title:appointment.namePatient+\" \"+appointment.nameSurname1+(appointment.nameSurname2?\" \"+appointment.nameSurname2:\"\"),start:dateStart,end:dateEnd,extendedProps:{idAppointment:appointment.idAppointment},className:appointmentStatus});});return events;};this.dateClick=info=>{this.props.onClose(info);};this.eventClick=info=>{if(info.event.extendedProps.idAppointment){this.setState({idAppointmentSelected:info.event.extendedProps.idAppointment});}else{this.setState({idScheduleSlotSelected:info.event.extendedProps.idScheduleSlot,dateSelected:info.event.start});}};this.dateSet=dateInfo=>{if(dayjs().isAfter(dayjs(dateInfo.start))&&dayjs().isBefore(dayjs(dateInfo.end))){var _this$calendarCompone;(_this$calendarCompone=this.calendarComponentRef.current)===null||_this$calendarCompone===void 0?void 0:_this$calendarCompone.getApi().scrollToTime(dayjs().subtract(1,\"hour\").format(\"HH:mm:ss\"));}else{var _this$calendarCompone2;(_this$calendarCompone2=this.calendarComponentRef.current)===null||_this$calendarCompone2===void 0?void 0:_this$calendarCompone2.getApi().scrollToTime(\"08:00:00\");}setTimeout(()=>{this.forceUpdate();},500);};}componentDidMount(){if(this.props.visible){this.loadData();}}render(){return this.state&&this.state.loaded?/*#__PURE__*/_jsx(View,{...this.state,visible:this.props.visible,onClose:this.props.onClose,calendarComponentRef:this.calendarComponentRef,events:this.events,eventClick:this.eventClick,dateClick:this.dateClick,dateSet:this.dateSet}):/*#__PURE__*/_jsx(_Fragment,{});}}export default withTranslation(\"newAppointmentForm\")(DoctorsCalendarContainer);","map":{"version":3,"names":["dayjs","React","withTranslation","enumAppointmentStatusNew","Rest","View","jsx","_jsx","Fragment","_Fragment","DoctorsCalendarContainer","Component","constructor","arguments","state","calendarComponentRef","createRef","loadData","setState","loaded","events","info","successCallback","operation","type","idProvider","props","prestadorSelected","dateStart","start","dateEnd","end","then","response","setEventStruct","allEvents","_allEvents$slots","_allEvents$appointmen","slots","forEach","slot","i","valueStart","valueEnd","date","format","toDate","setMinutes","valueInterval","push","extendedProps","idScheduleSlot","display","appointments","appointment","dateAppointment","valueTime","valueDuration","appointmentStatus","typeStatus","PROPOSED","CANCELLED","title","namePatient","nameSurname1","nameSurname2","idAppointment","className","dateClick","onClose","eventClick","event","idAppointmentSelected","idScheduleSlotSelected","dateSelected","dateSet","dateInfo","isAfter","isBefore","_this$calendarCompone","current","getApi","scrollToTime","subtract","_this$calendarCompone2","setTimeout","forceUpdate","componentDidMount","visible","render"],"sources":["/home/gpt2008/Desktop/Clubs/club/club/dentycard-policlinico-bo-ui/src/pages/agendas/DoctorsCalendarContainer.tsx"],"sourcesContent":["import { DatesSetArg } from \"@fullcalendar/core\";\nimport dayjs from \"dayjs\";\nimport React from \"react\";\nimport { WithTranslation, withTranslation } from \"react-i18next\";\nimport Appointment from \"types/entities/Appointment\";\nimport Slot from \"types/entities/Slot\";\nimport enumAppointmentStatusNew from \"types/enums/EnumAppointmentStatusNew\";\nimport { Rest } from \"../../utils/utils\";\nimport View from \"./DoctorsCalendar\";\n\ninterface IProps {\n\tvisible?: boolean;\n\tprestadorSelected: number;\n\tonClose: (info: any) => void;\n}\n\nexport interface IState {\n\tcalendarHeight?: number;\n\tloaded?: boolean;\n\tidScheduleSlotSelected?: number;\n\tidAppointmentSelected?: number;\n\tdateSelected?: Date;\n}\n\nclass DoctorsCalendarContainer extends React.Component<WithTranslation & IProps, IState> {\n\tpublic state: IState = {};\n\n\tcalendarComponentRef: any = React.createRef();\n\n\tpublic componentDidMount() {\n\t\tif (this.props.visible) {\n\t\t\tthis.loadData();\n\t\t}\n\t}\n\n\tpublic render() {\n\t\treturn this.state && this.state.loaded ? (\n\t\t\t<View\n\t\t\t\t{...this.state}\n\t\t\t\tvisible={this.props.visible}\n\t\t\t\tonClose={this.props.onClose}\n\t\t\t\tcalendarComponentRef={this.calendarComponentRef}\n\t\t\t\tevents={this.events}\n\t\t\t\teventClick={this.eventClick}\n\t\t\t\tdateClick={this.dateClick}\n\t\t\t\tdateSet={this.dateSet}\n\t\t\t/>\n\t\t) : (\n\t\t\t<></>\n\t\t);\n\t}\n\n\tprivate loadData = () => {\n\t\tthis.setState({ loaded: true });\n\t};\n\n\tprivate events = (info: any, successCallback: any) => {\n\t\tRest<{ type: string; idProvider: number; dateStart: Date; dateEnd: Date }, any>()\n\t\t\t.operation({\n\t\t\t\ttype: \"GetProviderSchedulesSlots\",\n\t\t\t\tidProvider: this.props.prestadorSelected!,\n\t\t\t\tdateStart: info.start,\n\t\t\t\tdateEnd: info.end,\n\t\t\t})\n\t\t\t.then((response) => {\n\t\t\t\tsuccessCallback(this.setEventStruct(response));\n\t\t\t});\n\t};\n\n\tprivate setEventStruct = (allEvents: any) => {\n\t\tconst events: any = [];\n\t\tallEvents.slots?.forEach((slot: Slot) => {\n\t\t\tlet i = slot.valueStart;\n\t\t\twhile (i < slot.valueEnd) {\n\t\t\t\tconst dateStart = dayjs(dayjs(slot.date).format(\"DD/MM/YYYY\"), \"DD/MM/YYYY\").toDate();\n\t\t\t\tdateStart.setMinutes(i);\n\n\t\t\t\tconst dateEnd = dayjs(dayjs(slot.date).format(\"DD/MM/YYYY\"), \"DD/MM/YYYY\").toDate();\n\t\t\t\tdateEnd.setMinutes(i + slot.valueInterval);\n\n\t\t\t\tevents.push({\n\t\t\t\t\tstart: dateStart,\n\t\t\t\t\tend: dateEnd,\n\t\t\t\t\textendedProps: { idScheduleSlot: slot.idScheduleSlot },\n\t\t\t\t\tdisplay: \"background\",\n\t\t\t\t});\n\t\t\t\ti += slot.valueInterval;\n\t\t\t}\n\t\t});\n\n\t\tallEvents.appointments?.forEach((appointment: Appointment) => {\n\t\t\tconst dateStart = dayjs(\n\t\t\t\tdayjs(appointment.dateAppointment).format(\"DD/MM/YYYY\"),\n\t\t\t\t\"DD/MM/YYYY\"\n\t\t\t).toDate();\n\t\t\tdateStart.setMinutes(appointment.valueTime);\n\n\t\t\tconst dateEnd = dayjs(\n\t\t\t\tdayjs(appointment.dateAppointment).format(\"DD/MM/YYYY\"),\n\t\t\t\t\"DD/MM/YYYY\"\n\t\t\t).toDate();\n\t\t\tdateEnd.setMinutes(appointment.valueTime + appointment.valueDuration);\n\n\t\t\tlet appointmentStatus = \"confirmed\";\n\n\t\t\tswitch (appointment.typeStatus) {\n\t\t\t\tcase enumAppointmentStatusNew.PROPOSED:\n\t\t\t\t\tappointmentStatus = \"proposed\";\n\t\t\t\t\tbreak;\n\t\t\t\tcase enumAppointmentStatusNew.CANCELLED:\n\t\t\t\t\tappointmentStatus = \"cancelled\";\n\t\t\t\t\tbreak;\n\t\t\t\tcase 5:\n\t\t\t\t\tappointmentStatus = \"payment\";\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tevents.push({\n\t\t\t\ttitle:\n\t\t\t\t\tappointment.namePatient +\n\t\t\t\t\t\" \" +\n\t\t\t\t\tappointment.nameSurname1 +\n\t\t\t\t\t(appointment.nameSurname2 ? \" \" + appointment.nameSurname2 : \"\"),\n\t\t\t\tstart: dateStart,\n\t\t\t\tend: dateEnd,\n\t\t\t\textendedProps: { idAppointment: appointment.idAppointment },\n\t\t\t\tclassName: appointmentStatus,\n\t\t\t});\n\t\t});\n\n\t\treturn events;\n\t};\n\n\tprivate dateClick = (info: any) => {\n\t\tthis.props.onClose(info);\n\t};\n\n\tprivate eventClick = (info: any) => {\n\t\tif (info.event.extendedProps.idAppointment) {\n\t\t\tthis.setState({\n\t\t\t\tidAppointmentSelected: info.event.extendedProps.idAppointment,\n\t\t\t});\n\t\t} else {\n\t\t\tthis.setState({\n\t\t\t\tidScheduleSlotSelected: info.event.extendedProps.idScheduleSlot,\n\t\t\t\tdateSelected: info.event.start,\n\t\t\t});\n\t\t}\n\t};\n\n\tprivate dateSet = (dateInfo: DatesSetArg) => {\n\t\tif (dayjs().isAfter(dayjs(dateInfo.start)) && dayjs().isBefore(dayjs(dateInfo.end))) {\n\t\t\tthis.calendarComponentRef.current\n\t\t\t\t?.getApi()\n\t\t\t\t.scrollToTime(dayjs().subtract(1, \"hour\").format(\"HH:mm:ss\"));\n\t\t} else {\n\t\t\tthis.calendarComponentRef.current?.getApi().scrollToTime(\"08:00:00\");\n\t\t}\n\n\t\tsetTimeout(() => {\n\t\t\tthis.forceUpdate();\n\t\t}, 500);\n\t};\n}\n\nexport default withTranslation(\"newAppointmentForm\")(DoctorsCalendarContainer);\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}