{"ast":null,"code":"import router from\"../router\";import EventHub,{Event}from\"./eventHub\";import{login}from\"./router-utils\";const URL=process.env.PUBLIC_URL;let history;export function setHistory(_history){history=_history;}class Rest{constructor(){this.header=void 0;this.header=new Headers();this.header.append(\"Accept\",\"application/json\");this.header.append(\"Content-type\",\"application/json;charset=utf-8\");this.header.append(\"Cache-Control\",\"no-cache\");this.header.append(\"Access-Control-Allow-Origin\",\"*\");this.header.append(\"Access-Control-Allow-Methods\",\"POST, GET, OPTIONS, PUT, DELETE\");/*this.header.append('X-CURRENT', '@' + btoa(encodeURI(window.location.href)) + '!');*/}operation(operation,dontMask){let serviceURL=\"/JsonService\";return this.fetchURL(serviceURL,{body:toJson(operation),cache:\"no-cache\",headers:this.header,method:\"POST\"},dontMask);}fetchURL(url,config,dontMask){const urlToFetch=URL+url;if(!config.headers||!config.headers.has(\"X-XSRF-TOKEN\")){const xsrfCookieValue=getCookie(\"XSRF-TOKEN\");if(xsrfCookieValue){if(!config.headers){config.headers=new Headers();}config.headers.set(\"X-XSRF-TOKEN\",xsrfCookieValue);}}const promise=new Promise((resolve,reject)=>{fetch(urlToFetch,config).then(Response=>{if(Response.status===200||Response.status===0){!dontMask&&EventHub.trigger(Event.LOADING_OFF);Response.text().then(res=>{resolve(fromJson(res));});}else{!dontMask&&EventHub.trigger(Event.LOADING_OFF);reject(Response.status);this.onError(Response.status);}}).catch(error=>{!dontMask&&EventHub.trigger(Event.LOADING_OFF);reject(-1);if(error.response){this.onError(error.response.status);}});});!dontMask&&EventHub.trigger(Event.LOADING_ON);return promise;}onError(status){switch(status){case 401:// login needed\ncase 419:// session expired\nrouter.navigate(login);break;default:// history.push({pathname: PathComunes.ERROR, state: {from: history.location.pathname}});\n}}}/*******************************************************************************\n * toJson & fromJson\n */function filterKeys(key,value){if(key&&key[0]===\"$\"){return undefined;/**\n\t\t * Adjust hour in date objects so the DateAdapter in backend\n\t\t * don't shift timezone of the parsed date object\n\t\t */}else{return value;}}function toJson(value){const result=JSON.stringify(value,filterKeys);return result;}// https://weblog.west-wind.com/posts/2014/jan/06/javascript-json-date-parsing-and-real-dates\nconst dateFormatISO=/^(\\d{4})-(\\d{2})-(\\d{2})T(\\d{2}):(\\d{2}):(\\d{2}(?:\\.\\d*))(?:Z|(\\+|-)([\\d|:]*))?$/;function dateParser(key,value){if(typeof value===\"string\"){if(dateFormatISO.test(value)){return new Date(value);}}return value;}function fromJson(){let str=arguments.length>0&&arguments[0]!==undefined?arguments[0]:\"\";const PROTECTION_PREFIX=/^\\)\\]\\}',?\\n/;const result=str.replace(PROTECTION_PREFIX,\"\");return JSON.parse(result,dateParser);}function getCookie(cname){const name=cname+\"=\";const ca=document.cookie.split(\";\");for(let i=0,length=ca.length;i<length;i++){let c=ca[i];while(c.charAt(0)===\" \"){c=c.substring(1);}if(c.indexOf(name)===0){return c.substring(name.length,c.length);}}return null;}export default function(){return new Rest();}export{URL};","map":{"version":3,"names":["router","EventHub","Event","login","URL","process","env","PUBLIC_URL","history","setHistory","_history","Rest","constructor","header","Headers","append","operation","dontMask","serviceURL","fetchURL","body","toJson","cache","headers","method","url","config","urlToFetch","has","xsrfCookieValue","getCookie","set","promise","Promise","resolve","reject","fetch","then","Response","status","trigger","LOADING_OFF","text","res","fromJson","onError","catch","error","response","LOADING_ON","navigate","filterKeys","key","value","undefined","result","JSON","stringify","dateFormatISO","dateParser","test","Date","str","arguments","length","PROTECTION_PREFIX","replace","parse","cname","name","ca","document","cookie","split","i","c","charAt","substring","indexOf"],"sources":["/home/gpt2008/Desktop/Clubs/club/club/dentycard-policlinico-bo-ui/src/utils/rest.tsx"],"sourcesContent":["import router from \"../router\";\nimport EventHub, { Event } from \"./eventHub\";\nimport { login } from \"./router-utils\";\n\nconst URL: string = process.env.PUBLIC_URL;\n\nlet history;\nexport function setHistory(_history: History) {\n\thistory = _history;\n}\n\nclass Rest<E, T> {\n\tprivate header: Headers;\n\n\tconstructor() {\n\t\tthis.header = new Headers();\n\t\tthis.header.append(\"Accept\", \"application/json\");\n\t\tthis.header.append(\"Content-type\", \"application/json;charset=utf-8\");\n\t\tthis.header.append(\"Cache-Control\", \"no-cache\");\n\t\tthis.header.append(\"Access-Control-Allow-Origin\", \"*\");\n\t\tthis.header.append(\"Access-Control-Allow-Methods\", \"POST, GET, OPTIONS, PUT, DELETE\");\n\t\t/*this.header.append('X-CURRENT', '@' + btoa(encodeURI(window.location.href)) + '!');*/\n\t}\n\n\tpublic operation(operation: E, dontMask?: boolean): Promise<T> {\n\t\tlet serviceURL = \"/JsonService\";\n\t\treturn this.fetchURL(\n\t\t\tserviceURL,\n\t\t\t{\n\t\t\t\tbody: toJson(operation),\n\t\t\t\tcache: \"no-cache\",\n\t\t\t\theaders: this.header,\n\t\t\t\tmethod: \"POST\",\n\t\t\t},\n\t\t\tdontMask\n\t\t);\n\t}\n\n\tpublic fetchURL(url: string, config: any, dontMask?: boolean): Promise<T> {\n\t\tconst urlToFetch = URL + url;\n\n\t\tif (!config.headers || !config.headers.has(\"X-XSRF-TOKEN\")) {\n\t\t\tconst xsrfCookieValue = getCookie(\"XSRF-TOKEN\");\n\t\t\tif (xsrfCookieValue) {\n\t\t\t\tif (!config.headers) {\n\t\t\t\t\tconfig.headers = new Headers();\n\t\t\t\t}\n\t\t\t\tconfig.headers.set(\"X-XSRF-TOKEN\", xsrfCookieValue);\n\t\t\t}\n\t\t}\n\n\t\tconst promise = new Promise<T>((resolve: (f: T) => void, reject: (f: number) => void) => {\n\t\t\tfetch(urlToFetch, config)\n\t\t\t\t.then((Response) => {\n\t\t\t\t\tif (Response.status === 200 || Response.status === 0) {\n\t\t\t\t\t\t!dontMask && EventHub.trigger(Event.LOADING_OFF);\n\t\t\t\t\t\tResponse.text().then((res) => {\n\t\t\t\t\t\t\tresolve(fromJson(res));\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\t!dontMask && EventHub.trigger(Event.LOADING_OFF);\n\t\t\t\t\t\treject(Response.status);\n\t\t\t\t\t\tthis.onError(Response.status);\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.catch((error) => {\n\t\t\t\t\t!dontMask && EventHub.trigger(Event.LOADING_OFF);\n\t\t\t\t\treject(-1);\n\t\t\t\t\tif (error.response) {\n\t\t\t\t\t\tthis.onError(error.response.status);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t});\n\n\t\t!dontMask && EventHub.trigger(Event.LOADING_ON);\n\t\treturn promise;\n\t}\n\n\tprivate onError(status: number) {\n\t\tswitch (status) {\n\t\t\tcase 401: // login needed\n\t\t\tcase 419: // session expired\n\t\t\t\trouter.navigate(login);\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t// history.push({pathname: PathComunes.ERROR, state: {from: history.location.pathname}});\n\t\t}\n\t}\n}\n\n/*******************************************************************************\n * toJson & fromJson\n */\n\nfunction filterKeys(key: string, value: any) {\n\tif (key && key[0] === \"$\") {\n\t\treturn undefined;\n\t\t/**\n\t\t * Adjust hour in date objects so the DateAdapter in backend\n\t\t * don't shift timezone of the parsed date object\n\t\t */\n\t} else {\n\t\treturn value;\n\t}\n}\n\nfunction toJson(value: any) {\n\tconst result = JSON.stringify(value, filterKeys);\n\treturn result;\n}\n\n// https://weblog.west-wind.com/posts/2014/jan/06/javascript-json-date-parsing-and-real-dates\nconst dateFormatISO =\n\t/^(\\d{4})-(\\d{2})-(\\d{2})T(\\d{2}):(\\d{2}):(\\d{2}(?:\\.\\d*))(?:Z|(\\+|-)([\\d|:]*))?$/;\nfunction dateParser(key: string, value: string) {\n\tif (typeof value === \"string\") {\n\t\tif (dateFormatISO.test(value)) {\n\t\t\treturn new Date(value);\n\t\t}\n\t}\n\treturn value;\n}\n\nfunction fromJson(str = \"\") {\n\tconst PROTECTION_PREFIX = /^\\)\\]\\}',?\\n/;\n\tconst result = str.replace(PROTECTION_PREFIX, \"\");\n\treturn JSON.parse(result, dateParser);\n}\n\nfunction getCookie(cname: string) {\n\tconst name = cname + \"=\";\n\tconst ca = document.cookie.split(\";\");\n\tfor (let i = 0, length = ca.length; i < length; i++) {\n\t\tlet c = ca[i];\n\t\twhile (c.charAt(0) === \" \") {\n\t\t\tc = c.substring(1);\n\t\t}\n\t\tif (c.indexOf(name) === 0) {\n\t\t\treturn c.substring(name.length, c.length);\n\t\t}\n\t}\n\n\treturn null;\n}\n\nexport default function <E, T>() {\n\treturn new Rest<E, T>();\n}\n\nexport { URL };\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}